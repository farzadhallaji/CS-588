{"instance": {"idx": 23, "lang": "java", "meta": {"id": "41655", "proj": "apache-iceberg", "index": "8040"}}, "seed_review": "The other properties are `file-open-cost`, not `open-file-cost`.", "claims": ["A new constant named \"OPEN_FILE_COST\" has been added to the interface \"RewriteDataFiles\".", "This constant is of type String and is initialized with the value \"open-file-cost\".", "A comment has been added above the new constant to explain its purpose. The comment suggests that the constant is used to store the estimated cost to open a file.", "The comment also mentions that the default value of the constant will be the \"read.split.open-file-cost\" from the table properties of the table being updated.", "The addition of the new constant \"OPEN_FILE_COST\" suggests that there might"], "patch": "@@ -76,6 +76,12 @@ public interface RewriteDataFiles extends SnapshotUpdate<RewriteDataFiles, Rewri\n    */\n   String TARGET_FILE_SIZE_BYTES = \"target-file-size-bytes\";\n \n+  /**\n+   * The estimated cost to open a file, used as a minimum weight when combining splits. By default this\n+   * will use the \"read.split.open-file-cost\" value in the table properties of the table being updated.\n+   */\n+  String OPEN_FILE_COST = \"open-file-cost\";\n+\n   /**\n    * Choose BINPACK as a strategy for this rewrite operation\n    * @return this for method chaining", "old_file": "/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\npackage org.apache.iceberg.actions;\n\nimport java.util.List;\nimport org.apache.iceberg.StructLike;\nimport org.apache.iceberg.expressions.Expression;\n\n/**\n * An action for rewriting data files according to a rewrite strategy.\n * Generally used for optimizing the sizing and layout of data files within a table.\n */\npublic interface RewriteDataFiles extends SnapshotUpdate<RewriteDataFiles, RewriteDataFiles.Result> {\n\n  /**\n   * Enable committing groups of files (see max-file-group-size-bytes) prior to the entire rewrite completing.\n   * This will produce additional commits but allow for progress even if some groups fail to commit. This setting\n   * will not change the correctness of the rewrite operation as file groups can be compacted independently.\n   * <p>\n   * The default is false, which produces a single commit when the entire job has completed.\n   */\n  String PARTIAL_PROGRESS_ENABLED = \"partial-progress.enabled\";\n  boolean PARTIAL_PROGRESS_ENABLED_DEFAULT = false;\n\n  /**\n   * The maximum amount of Iceberg commits that this rewrite is allowed to produce if partial progress is enabled. This\n   * setting has no effect if partial progress is disabled.\n   */\n  String PARTIAL_PROGRESS_MAX_COMMITS = \"partial-progress.max-commits\";\n  int PARTIAL_PROGRESS_MAX_COMMITS_DEFAULT = 10;\n\n  /**\n   * The entire rewrite operation is broken down into pieces based on partitioning and within partitions based\n   * on size into groups. These sub-units of the rewrite are referred to as file groups. The largest amount of data that\n   * should be compacted in a single group is controlled by {@link #MAX_FILE_GROUP_SIZE_BYTES}. This helps with\n   * breaking down the rewriting of very large partitions which may not be rewritable otherwise due to the resource\n   * constraints of the cluster. For example a sort based rewrite may not scale to terabyte sized partitions, those\n   * partitions need to be worked on in small subsections to avoid exhaustion of resources.\n   * <p>\n   * When grouping files, the underlying rewrite strategy will use this value as to limit the files which\n   * will be included in a single file group. A group will be processed by a single framework \"action\". For example,\n   * in Spark this means that each group would be rewritten in its own Spark action. A group will never contain files\n   * for multiple output partitions.\n   */\n  String MAX_FILE_GROUP_SIZE_BYTES = \"max-file-group-size-bytes\";\n  long MAX_FILE_GROUP_SIZE_BYTES_DEFAULT = 1024L * 1024L * 1024L * 100L; // 100 Gigabytes\n\n  /**\n   * The max number of file groups to be simultaneously rewritten by the rewrite strategy. The structure and\n   * contents of the group is determined by the rewrite strategy. Each file group will be rewritten\n   * independently and asynchronously.\n   **/\n  String MAX_CONCURRENT_FILE_GROUP_REWRITES = \"max-concurrent-file-group-rewrites\";\n  int MAX_CONCURRENT_FILE_GROUP_REWRITES_DEFAULT = 1;\n\n  /**\n   * The output file size that this rewrite strategy will attempt to generate when rewriting files. By default this\n   * will use the \"write.target-file-size-bytes value\" in the table properties of the table being updated.\n   */\n  String TARGET_FILE_SIZE_BYTES = \"target-file-size-bytes\";\n\n  /**\n   * Choose BINPACK as a strategy for this rewrite operation\n   * @return this for method chaining\n   */\n  default RewriteDataFiles binPack() {\n    return this;\n  }\n\n  /**\n   * A user provided filter for determining which files will be considered by the rewrite strategy. This will be used\n   * in addition to whatever rules the rewrite strategy generates. For example this would be used for providing a\n   * restriction to only run rewrite on a specific partition.\n   *\n   * @param expression An iceberg expression used to determine which files will be considered for rewriting\n   * @return this for chaining\n   */\n  RewriteDataFiles filter(Expression expression);\n\n  /**\n   * A map of file group information to the results of rewriting that file group. If the results are null then\n   * that particular file group failed. We should only have failed groups if partial progress is enabled otherwise we\n   * will report a total failure for the job.\n   */\n  interface Result {\n    List<FileGroupRewriteResult> rewriteResults();\n\n    default int addedDataFilesCount() {\n      return rewriteResults().stream().mapToInt(FileGroupRewriteResult::addedDataFilesCount).sum();\n    }\n\n    default int rewrittenDataFilesCount() {\n      return rewriteResults().stream().mapToInt(FileGroupRewriteResult::rewrittenDataFilesCount).sum();\n    }\n  }\n\n  /**\n   *  For a particular file group, the number of files which are newly created and the number of files\n   *  which were formerly part of the table but have been rewritten.\n   */\n  interface FileGroupRewriteResult {\n    FileGroupInfo info();\n\n    int addedDataFilesCount();\n\n    int rewrittenDataFilesCount();\n  }\n\n  /**\n   * A description of a file group, when it was processed, and within which partition. For use\n   * tracking rewrite operations and for returning results.\n   */\n  interface FileGroupInfo {\n\n    /**\n     * returns which file group this is out of the total set of file groups for this rewrite\n     */\n    int globalIndex();\n\n    /**\n     * returns which file group this is out of the set of file groups for this partition\n     */\n    int partitionIndex();\n\n    /**\n     * returns which partition this file group contains files from\n     */\n    StructLike partition();\n  }\n}\n", "evidence": {"A new constant named \"OPEN_FILE_COST\" has been added to the interface \"RewriteDataFiles\".": ["* The estimated cost to open a file, used as a minimum weight when combining splits. By default this", "* The output file size that this rewrite strategy will attempt to generate when rewriting files. By default this", "* will use the \"read.split.open-file-cost\" value in the table properties of the table being updated."], "This constant is of type String and is initialized with the value \"open-file-cost\".": ["* will use the \"read.split.open-file-cost\" value in the table properties of the table being updated.", "* The estimated cost to open a file, used as a minimum weight when combining splits. By default this", "* The output file size that this rewrite strategy will attempt to generate when rewriting files. By default this"], "A comment has been added above the new constant to explain its purpose. The comment suggests that the constant is used to store the estimated cost to open a file.": ["* The estimated cost to open a file, used as a minimum weight when combining splits. By default this", "* The output file size that this rewrite strategy will attempt to generate when rewriting files. By default this", "* will use the \"read.split.open-file-cost\" value in the table properties of the table being updated."], "The comment also mentions that the default value of the constant will be the \"read.split.open-file-cost\" from the table properties of the table being updated.": ["* will use the \"read.split.open-file-cost\" value in the table properties of the table being updated.", "* will use the \"write.target-file-size-bytes value\" in the table properties of the table being updated.", "* The output file size that this rewrite strategy will attempt to generate when rewriting files. By default this"], "The addition of the new constant \"OPEN_FILE_COST\" suggests that there might": ["* will use the \"read.split.open-file-cost\" value in the table properties of the table being updated.", "* The output file size that this rewrite strategy will attempt to generate when rewriting files. By default this", "* will use the \"write.target-file-size-bytes value\" in the table properties of the table being updated."]}, "candidates": [{"text": "The constant `OPEN_FILE_COST` has been added to the interface `RewriteDataFiles`, initialized with the value \"open-file-cost\". The comment above the constant explains its purpose as storing the estimated cost to open a file, and notes that the default value will be taken from the table properties. However, it's worth noting that the property name is actually \"file-open-cost\", not \"open-file-cost\".", "prompt_variant": "default", "temperature": 0.3, "prompt": "You are improving a code review comment.\n\nSeed review:\nThe other properties are `file-open-cost`, not `open-file-cost`.\n\nPseudo-references (claims about what should be mentioned):\n- A new constant named \"OPEN_FILE_COST\" has been added to the interface \"RewriteDataFiles\".\n- This constant is of type String and is initialized with the value \"open-file-cost\".\n- A comment has been added above the new constant to explain its purpose. The comment suggests that the constant is used to store the estimated cost to open a file.\n- The comment also mentions that the default value of the constant will be the \"read.split.open-file-cost\" from the table properties of the table being updated.\n- The addition of the new constant \"OPEN_FILE_COST\" suggests that there might\n\nTask:\nRewrite the review so it covers the important claims, stays concise, and does not add new unverifiable claims.\nReturn ONLY the rewritten review text.", "model_type": "ollama", "model_name": "llama3:8b-instruct-q4_0"}, {"text": "The `file-open-cost` property is misspelled as `open-file-cost`. This inconsistency should be corrected to maintain consistency with other properties.\n\nNote: The comment above the constant explains its purpose, but this review focuses on the spelling error itself.", "prompt_variant": "default", "temperature": 0.3, "prompt": "You are improving a code review comment.\n\nSeed review:\nThe other properties are `file-open-cost`, not `open-file-cost`.\n\nPseudo-references (claims about what should be mentioned):\n- A new constant named \"OPEN_FILE_COST\" has been added to the interface \"RewriteDataFiles\".\n- This constant is of type String and is initialized with the value \"open-file-cost\".\n- A comment has been added above the new constant to explain its purpose. The comment suggests that the constant is used to store the estimated cost to open a file.\n- The comment also mentions that the default value of the constant will be the \"read.split.open-file-cost\" from the table properties of the table being updated.\n- The addition of the new constant \"OPEN_FILE_COST\" suggests that there might\n\nTask:\nRewrite the review so it covers the important claims, stays concise, and does not add new unverifiable claims.\nReturn ONLY the rewritten review text.", "model_type": "ollama", "model_name": "llama3:8b-instruct-q4_0"}], "tau": 0.7314}
